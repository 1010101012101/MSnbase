---
title: "MSnbase benchmarking"
output:
  BiocStyle::html_document:
     toc: true
     toc_depth: 1
vignette: >
  % \VignetteIndexEntry{MSnbase benchmarking}
  % \VignetteEngine{knitr::rmarkdown}
  % \VignetteKeyword{proteomics, mass spectrometry}
  % \VignettePackage{MSnbase}
---


```{r style, echo = FALSE, results = 'asis', message=FALSE}
BiocStyle::markdown()
```

```{r env, echo=FALSE, message=FALSE}
suppressPackageStartupMessages(library("MSnbase"))
```

**Package**: `r Biocpkg("MSnbase")`<br />
**Authors**: Laurent Gatto and Johannes Rainer<br />
**Modified:** `r file.info("benchmarkding.Rmd")$mtime`<br />
**Compiled**: `r date()`

# Introduction

In this vignette, we will document various timings and benchmarkings
of the recent `r Biocpkg("MSnbase")` development (aka `MSnbase2`),
that focuses on *on-disk* data access (as opposed to
*in-memory*). More details about the new implementation will be
documented elsewhere.

As a benchmarking dataset, we are going to use a subset of an TMT
6-plex experiment acquired on an LTQ Orbitrap Velos, that is
distributed with the `r Biocexptpkg("msdata")` package

```{r msdata}
library("msdata")
f <- msdata::proteomics(full.names = TRUE)
f
```

We need to load the `r Biocpkg("MSnbase")` package and set the
session-wide verbosity flag to `FALSE`.

```{r verb}
library("MSnbase")
setMSnbaseVerbose(FALSE)
```

# Reading data

We first read the data using the original `readMSData` function that
generates an in-memory representation of the MS2-level raw data and
measure the time needed for this operation.

```{r read1}
system.time(inmem <- readMSData(f, msLevel = 2, centroided = TRUE))
```

Next, we use the `readMSData2` function to generate an on-disk
representation of the same data.

```{r read2}
system.time(ondisk <- readMSData2(f, msLevel = 2, centroided = TRUE))
```

Creating the on-disk experiment is considerable faster and scales to
much bigger, multi-file data, both in terms of object creation time,
but also in terms of object size (see next section). We must of course
make sure that these two datasets are equivalent:

```{r equal12}
all.equal(inmem, ondisk)
```

# Data size

To compare the size occupied in memory of these two objects, we are
going to use the `object_size` function from the `r CRANpkg("pryr")`
package, which accounts for the data (the spectar) in the `assayData`
environment (as opposed to the `object.size` function from the `utils`
package).

```{r}
library("pryr")
object_size(inmem)
object_size(ondisk)
```

The difference is explained by the fact that for `ondisk`, the spectra
are not created and stored in memory; they are access on disk when
needed, such as for example for plotting:

```{r plot0, eval=FALSE}
plot(inmem[[200]], reporters = TMT6, full = TRUE)
plot(ondisk[[200]], reporters = TMT6, full = TRUE)
```

```{r plot1, echo=FALSE}
suppressPackageStartupMessages(library("gridExtra"))
grid.arrange(plot(inmem[[200]], reporters = TMT6, full = TRUE),
             plot(ondisk[[200]], reporters = TMT6, full = TRUE),
             ncol = 2)
```

# Accessing spectra

The drawback of the on-disk representation is when the spectrum data
has to actually be accessed. To compare access time, we are going to use the microba

```{r}

```

# MS2 quantitation
